if("undefined"==typeof com)var com={};"undefined"==typeof com.mad&&(com.mad={});"undefined"==typeof com.mad.chart&&(com.mad.chart={});
com.mad.chart.handler=function(l,g){if(!d3)throw $debug("Not Found D3 Library."),Error("D3 Object Exception");this.oContaner=l;this.oOption=g instanceof Array?g[0]:g;this.oOptions=g instanceof Array?g:null};
com.mad.chart.handler.prototype={logging:function(l){$debug("com.mad.chart : "+l)},empty:function(){$(this.oContaner).hide("slow").empty().show();return this},message:function(l){$(this.oContaner).empty().append(l);return this},draw:function(l,g){var c=this,u=function(n,d){return d3.select(c.oContaner).append("svg").attr("width","number"==typeof n?n:c.oOption.width).attr("height","number"==typeof d?d:c.oOption.height).append("g").attr("transform","translate("+("number"==typeof n?n:c.oOption.width)/2+","+("number"==typeof d?d:c.oOption.height)/2+")")},t=function(){return d3.select(c.oContaner).append("svg").attr("width",c.oOption.width).attr("height",c.oOption.height).append("g").attr("transform","translate("+c.oOption.margin.left+","+c.oOption.margin.top+")")},v=function(n,d){"function"==typeof c.oOption.format&&n.forEach(function(b){b.date=c.oOption.format(b.date)});var a=c.oOption.margin,p=c.oOption.width-a.left-a.right,a=c.oOption.height-a.top-a.bottom,k=d3.time.scale().range([0,p]),f=d3.scale.linear().range([a,0]),e=d3.scale.ordinal().range(c.oOption.colors),p=d3.svg.axis().scale(k).orient("bottom"),m=d3.svg.axis().scale(f).orient("left"),r=d3.svg.line().x(function(b){return k(b.date)}).y(function(b){return f(b.value)});d.xAxis&&(d.xAxis.format?p.ticks(d.xAxis.ticks).tickFormat(d3.time.format(d.xAxis.format)):p.ticks(d.xAxis.ticks));d.yAxis&&(d.yAxis.format?m.ticks(d.yAxis.ticks).tickFormat(d3.time.format(d.yAxis.format)):m.ticks(d.yAxis.ticks));e.domain(d3.keys(n[0]).filter(function(b){return"date"!==b}));var h=e.domain().map(function(b){return{name:b,values:n.map(function(h){return{date:h.date,value:+h[b]}})}});k.domain(d3.extent(n,function(b){return b.date}));f.domain([d3.min(h,function(b){return d3.min(b.values,function(b){return b.value})}),d3.max(h,function(b){return d3.max(b.values,function(b){return b.value})})]);var l=t();l.append("g").attr("class","x axis").attr("transform","translate(0,"+a+")").call(p);l.append("g").attr("class","y axis").call(m);var g=l.selectAll(".LineGraph").data(h).enter().append("g").attr("class",c.oOption.styleCalss);g.append("path").attr("class",c.oOption.styleCalss).attr("d",function(b){return r(b.values)}).style("stroke",function(b){return e(b.name)});c.oOption.showLabels&&g.append("text").datum(function(b){return{name:b.name,value:b.values[b.values.length-1]}}).attr("transform",function(b){return"translate("+k(b.value.date)+","+f(b.value.value)+")"}).attr("x",8).attr("dy",".35em").attr("class","lable").style("fill",function(b){return e(b.name)}).text(function(b){return b.name});h.forEach(function(b){var h="circle",a=6,c="#fff";d&&d.point&&(h=d.point.type,a=d.point.size,c=d.point.fill?e(b.name):c);if("circle"==h)g.selectAll(".point_"+b.name).data(b.values).enter().append(h).style("fill",c).style("stroke",e(b.name)).style("stroke-width","2px").style("opacity",function(b,a){return String(b.value).isEmpty()||"0"==b.value?0:1}).attr("r",a).attr("cx",function(b,a){return k(b.date)}).attr("cy",function(b,a){return f(b.value)}).on("mouseover",function(h){String(h.value).isEmpty()||"0"==h.value||(d3.select(this).attr("r",a+2),s(!0,k(h.date),f(h.value),e(b.name),String(h.value).money()))}).on("mouseout",function(b){String(b.value).isEmpty()||"0"==b.value||(d3.select(this).attr("r",a),s(!1))});else g.selectAll(".point_"+b.name).data(b.values).enter().append(h).style("fill",c).style("stroke",e(b.name)).style("stroke-width","2px").style("opacity",function(b,a){return String(b.value).isEmpty()||"0"==b.value?0:1}).attr("width",a).attr("height",a).attr("x",function(b,h){return k(b.date)-a/2}).attr("y",function(b,h){return f(b.value)-a/2}).on("mouseover",function(h){String(h.value).isEmpty()||"0"==h.value||(d3.select(this).attr("width",a+2).attr("height",a+2).attr("x",function(b,h){return k(b.date)-(a+2)/2}).attr("y",function(b,h){return f(b.value)-(a+2)/2}),s(!0,k(h.date),f(h.value),e(b.name),String(h.value).money()))}).on("mouseout",function(b){String(b.value).isEmpty()||"0"==b.value||(d3.select(this).attr("width",a).attr("height",a).attr("x",function(b,h){return k(b.date)-a/2}).attr("y",function(b,h){return f(b.value)-a/2}),s(!1))})});l.append("rect").style("opacity",0).attr("class",".infobox");var q=l.append("text").style("opacity",0),s=function(b,h,a,c,d){b?q.style("fill",c).attr("x",h+8).attr("y",a-10).text(d).transition(200).style("opacity",1):q.transition(200).text("").style("opacity",0)}},w=function(n,d){"function"==typeof c.oOption.format&&n.forEach(function(b){b.key=c.oOption.format(b.key)});var a=c.oOption,p=a.margin,k=a.width-p.left-p.right,f=a.height-p.top-p.bottom,e=d3.scale.ordinal().range(a.colors),m=d3.scale.ordinal().rangeRoundBands([0,k],.1),r=d3.scale.linear().range([f,0]),k=d3.svg.axis().scale(m).orient("bottom"),h=d3.svg.axis().scale(r).orient("left");d.xAxis&&(d.xAxis.format?k.ticks(d.xAxis.ticks).tickFormat(d3.time.format(d.xAxis.format)):k.ticks(d.xAxis.ticks));d.yAxis&&(d.yAxis.format?h.ticks(d.yAxis.ticks,"%").tickFormat(d3.time.format(d.yAxis.format)):h.ticks(d.yAxis.ticks,"%"));e.domain(d3.keys(n[0]).filter(function(b){return"date"!==b}));m.domain(n.map(function(b){return b.key}));r.domain([0,.1>d3.max(n,function(b){return b.value})?.1:d3.max(n,function(b){return b.value})]);var l=.3*m.rangeBand(),g=t();g.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(k);g.append("g").attr("class","y axis").call(h);g.selectAll(".bar").data(n).enter().append("rect").style("fill","#eaeaea").attr("x",function(b){return m(b.key)+.5*l}).attr("y",0).attr("width",m.rangeBand()-l).attr("height",f);g.selectAll(".bar").data(n).enter().append("rect").style("fill",function(b){return e(b.key)}).attr("x",function(b){return m(b.key)+.5*l}).attr("y",function(b){return r(b.value)}).attr("width",m.rangeBand()-l).attr("height",function(b){return f-r(b.value)}).on("mouseover",function(b){if(!String(b.value).isEmpty()&&"0"!=b.value){d3.select(this).style("stroke","#fff").style("stroke-width","5px").style("stroke-opacity",".4");var h=m(b.key)-l,a=r(b.value)+5;s(!0,h,a<25-p.top?25:a,"#000",b.text)}}).on("mouseout",function(b){String(b.value).isEmpty()||"0"==b.value||(d3.select(this).style("stroke-width","0px"),s(!1))});a.showLabels&&g.selectAll(".bar").data(n).enter().append("text").attr("x",function(b){return m(b.key)}).attr("y",function(b){b=r(b.value);return 15>b?15:b>f-10?f-10:b}).style("fill","#000").style("font-size","12").style("font-weight","700").style("text-anchor","left").text(function(b){return 0==b.value?"":b.text});g.append("rect").style("opacity",0).attr("class",".infobox");var q=g.append("text").style("opacity",0),s=function(b,h,a,c,d){b?q.style("fill",c).attr("x",h+8).attr("y",a-10).text(d).transition(200).style("opacity",1):q.transition(200).text("").style("opacity",0)}},x=function(n,d){var a=Math.min(c.oOption.width,c.oOption.height)/2,p=d3.scale.ordinal().range(c.oOption.colors),k=d3.svg.arc().outerRadius(a-c.oOption.arcOuter).innerRadius(a-c.oOption.arcInner),a=d3.layout.pie().sort(null).value(function(a){return a.value}),f=u();"object"==typeof c.oOption.background&&null!=c.oOption.background&&0<c.oOption.background.length&&q(f.selectAll("image").data([0]),c.oOption.background);a=f.selectAll(".arc").data(a(n)).enter().append("g").attr("class",c.oOption.styleCalss);a.append("path").attr("d",k).style("fill",function(a){return p(a.data.name)});if("object"==typeof c.oOption.lines&&c.oOption.lines instanceof Array)for(f=c.oOption.lines.length-1;0<=f;f--){var e=c.oOption.lines[f];a.append("line").attr("x1",e.x1).attr("x2",e.x2).attr("y1",e.y1).attr("y2",e.y2)}if("object"==typeof d&&d.lines instanceof Array)for(f=d.lines.length-1;0<=f;f--)e=d.lines[f],a.append("line").attr("x1",e.x1).attr("x2",e.x2).attr("y1",e.y1).attr("y2",e.y2);if("object"==typeof c.oOption.lables&&c.oOption.lables instanceof Array)for(f=c.oOption.lables.length-1;0<=f;f--)e=c.oOption.lables[f],a.append("text").attr("x",e.x).attr("y",e.y).attr("class",e.styleCalss).style("fill",e.fill).text(""+e.text);if("object"==typeof d&&d.lables instanceof Array)for(f=d.lables.length-1;0<=f;f--)e=d.lables[f],a.append("text").attr("x",e.x).attr("y",e.y).attr("class",e.styleCalss).style("fill",e.fill).text(""+e.text);c.oOption.showLabels&&a.append("text").attr("transform",function(a){return"translate("+k.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.name})},y=function(n,d){if(0<c.oOptions.length)for(var a=u(),p=c.oOptions.length-1;0<=p;p--){var k=c.oOptions[p],f=Math.min(k.width,k.height)/2,e=d3.scale.ordinal().range(k.colors),m=d3.svg.arc().outerRadius(f-k.arcOuter).innerRadius(f-k.arcInner),f=d3.layout.pie().sort(null).value(function(a){return a.depth==p?a.value:null});"object"==typeof k.background&&null!=k.background&&0<k.background.length&&q(a.selectAll("image").data([0]),k.background);f=a.selectAll(".arc ._"+p+"").data(f(n)).enter().append("g").attr("class",k.styleCalss);f.append("path").attr("d",m).style("fill",function(a){return e(a.data.name)});k.showLabels&&f.append("text").attr("transform",function(a){return"translate("+m.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return 0<a.data.value?a.data.name:""})}},z=function(n,d){var a=c.oOption,p=a.width,k=a.height,f=d3.scale.ordinal().range(a.colors),e=d3.scale.linear().range([0,p]),m=d3.scale.ordinal().rangeRoundBands([0,k],.4);d3.svg.axis().scale(e).orient("top");e.domain(d3.extent(n,function(a){return a.value})).nice();m.domain(n.map(function(a){return a.name}));var g=t().selectAll(".axis").data(n).enter().append("g").attr("class","axis");g.append("rect").style("fill","#eaeaea").attr("x",0).attr("y",function(a){return m(a.name)-20}).attr("width",p).attr("height",m.rangeBand());g.append("rect").style("fill",function(a){return f(a.name)}).attr("x",function(a){return e(Math.min(0,a.value))}).attr("y",function(a){return m(a.name)-20}).attr("width",function(a){return Math.abs(e(a.value)-e(0))}).attr("height",m.rangeBand());g.append("text").attr("x",function(a){return 5}).attr("y",function(a){return m(a.name)+35}).style("fill","#335").style("font-size","13").style("font-weight","900").style("text-anchor","left").text(function(a){return a.text});g.append("text").attr("x",function(a){return 10}).attr("y",function(a){return m(a.name)+5}).style("fill","#fefefe").style("font-size","13").style("font-weight","700").style("text-anchor","left").text(function(a){return a.value+a.prepix});g.append("line").attr("x1",e(0)).attr("x2",e(0)).attr("y2",k);a&&"object"==typeof a.image&&null!=a.image&&0<a.image.length&&q(g.selectAll("image").data([0]),a.image);d&&"object"==typeof d.image&&null!=d.image&&0<d.image.length&&q(g.selectAll("image").data([0]),d.image)},A=function(g,d){var a=c.oOption,p=a.width,k=a.height,f=d3.scale.ordinal().range(a.colors),e=d3.scale.linear().range([0,p-a.margin.right]),m=d3.scale.ordinal().rangeRoundBands([0,k],.4);d3.svg.axis().scale(e).orient("top");e.domain(d3.extent(g,function(a){return a.value})).nice();m.domain(g.map(function(a){return a.name}));var l=t().selectAll(".axis").data(g).enter().append("g").attr("class","axis");l.append("rect").style("fill","#eaeaea").attr("x",0).attr("y",function(a){return m(a.name)}).attr("width",p-a.margin.right).attr("height",m.rangeBand());l.append("rect").style("fill",function(a){return f(a.name)}).attr("x",function(a){return e(Math.min(0,a.value))}).attr("y",function(a){return m(a.name)}).attr("width",function(a){return Math.abs(e(a.value)-e(0))}).attr("height",m.rangeBand());l.append("text").attr("x",function(c){return p-a.margin.right+5}).attr("y",function(a){return m(a.name)+m.rangeBand()/2+2}).style("fill","#666").style("font-size","12").style("font-weight","700").style("text-anchor","left").text(function(a){return a.text});a.showLabels&&l.append("text").attr("x",function(a){a=Math.abs(e(a.value)-e(0));return 100>a?a+5:a-40}).attr("y",function(a){return m(a.name)+m.rangeBand()/2+3}).style("fill","#fff").style("font-size","12").style("font-weight","700").style("text-anchor","left").text(function(a){a=100*a.value;return(0==a%10?a:a.toFixed(2))+"%"});l.append("line").attr("x1",e(0)).attr("x2",e(0)).attr("y2",k);a&&"object"==typeof a.image&&null!=a.image&&0<a.image.length&&q(l.selectAll("image").data([0]),a.image);d&&"object"==typeof d.image&&null!=d.image&&0<d.image.length&&q(l.selectAll("image").data([0]),d.image)},B=function(g,d){var a=c.oOption.width,l=c.oOption.height,k={w:a-130,h:l-50,maxValue:1,levels:5,TranslateX:45,TranslateY:32,ExtraWidthX:140,ExtraWidthY:50,color:d3.scale.ordinal().range(c.oOption.colors),viewLevel:c.oOption.showLabels,viewLable:c.oOption.showLabels};RadarChart.draw(c.oContaner,g,k);a=d3.select(c.oContaner).selectAll("svg").append("svg").attr("width",a).attr("height",l);"object"==typeof c.oOption.background&&null!=c.oOption.background&&0<c.oOption.background.length&&q(a.selectAll("image").data([0]),c.oOption.background)},q=function(c,d){for(var a=0;a<d.length;a++)c.enter().append("svg:image").attr("xlink:href",d[a].href).attr("x",d[a].x).attr("y",d[a].y).attr("width",d[a].width).attr("height",d[a].height)};$(c.oContaner).hide().empty();switch(this.oOption.type){case "multiLine":v(l,g);break;case "bar":w(l,g);break;case "pie":x(l,g);break;case "piePartition":y(l,g);break;case "band":z(l,g);break;case "band2":A(l,g);break;case "radarChart":B(l,g)}$(c.oContaner).show("fast")}};